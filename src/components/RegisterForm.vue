<template>
<form id= "registerForm" @submit.prevent="uploadPhoto" enctype="multipart/form-data">

<label for="username"> Username</label>
<p> Please provide a username</p>
<input type="text"/><br>

<label for="password">Password</label>
<p> Please provide a password</p>
<input type="text"/><br>

<label for="email"> Email</label>
<p>Please provide an email address</p>
<input type="text"/><br>

<label for="name">Name</label>
<p>Please provide a Name</p>
<input type="text"/><br>


<label for="location">Address</label>
<p>Please provide your home address</p>
<input type="text"/><br>


<label for="biography">Biography</label>
<p>Please provide a brief biography</p>
<input type="text"/><br>


<label for="photo">Photo</label>
<p>Upload your photo</p>
<br><input type="file" name="photo"/><br>

<br><button type="submit"   value="register"> Register</button>


</form>

</template>


<script>
export default{
 data(){
  return {
     csrf_token:''
  }
 },

 created(){
    this.getCsrfToken();
 },

methods:{

  uploadPhoto() {
    let self= this;
    let registerForm= document.getElementById('registerForm');
    let form_data = new FormData(registerForm);
   fetch("/api/register", {
      method: 'POST',
      body:form_data,
      headers:{
         'X-CSRFToken': this.csrf_token
      }
   })

   .then(function(response){
   	  return response.json();
   })
   .then(function (data){
     console.log(data);
   })
   .catch(function (error){
     console.log(error);
   });

  },
  getCsrfToken() {
   let self=this;
   fetch('/api/csrf-token')
     .then((response) => response.json())
     .then((data) => {
       console.log(data);
         self.csrf_token = data.csrf_token;
     })
  }
	
 }
};



</script>


<!--<template>
    <form class="form-signin" @submit.prevent="registerUser" id="registerForm" method="POST" enctype="multipart/form-data">
        <div v-if="message" class="alert alert-success" role="alert">{{ message }}</div>
        <li v-for ="err in errorFlask " class="alert alert-danger" role="alert">{{ err }}</li>
        <h1 class="h3 mb-3 font-weight-normal">Register New User</h1>
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" class="form-control" placeholder="Username" required>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" class="form-control" placeholder="Password" required>
        </div>
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" class="form-control" placeholder="Name" required>
        </div>
        <div class="form-group">
            <label for="email">Email address</label>
            <input type="email" id="email" name="email" class="form-control" placeholder="Email address" required>
        </div>
        <div class="form-group">
            <label for="location">Location</label>
            <input type="text" id="location" name="location" class="form-control" placeholder="Location" required>
        </div>
        <div class="form-group">
            <label for="biography">Biography</label>
            <textarea id="biography" name="biography" class="form-control" placeholder="Biography" required></textarea>
        </div>
        <div class="form-group">
            <label for="photo">Profile Picture</label>
            <input type="file" id="photo" class="form-control-file" name="photo" placeholder="Profile Picture" @change="fileSelected" required>
        </div>
        <div></div>
        <button class="btn btn-lg btn-primary btn-block  bg-dark" type="submit">Register</button> 
    </form>
</template>

<script>
export default {
    data() {
        return {
            csrfToken: '',
            errorFlask: [],
            message: ''
        }
    },

    created() {
        this.getCsrfToken();
    },

    methods: {
        registerUser() {
            let registerForm = document.getElementById('registerForm');
            let form_data = new FormData(registerForm);
            let self = this;

            fetch("/api/register", {
                method: 'POST',
                body: form_data,
                headers: { 
                    'X-CSRF-TOKEN': this.csrfToken
                }

            })
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    // display a success message
                    self.message = data.message;
                    console.log(data);
                    if(data.errors.length > 0) {
                        self.errorFlask = data.errors;
                    }
                })
                .catch(function (error) {
                    // display an error message

                    // Having issues here
                    self.errorFlask = error.errors;
                    console.log(error);
                });

        },

         getCsrfToken() {
            let self = this;
            fetch("/api/csrf-token")
                .then((response) => {
                    return response.json();
                })
                .then((data) => {
                    console.log(data);
                    self.csrfToken = data.csrf_token;
                })
        }
    }
}
</script> -->
